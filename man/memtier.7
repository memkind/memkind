.\" SPDX-License-Identifier: BSD-2-Clause
.\" Copyright (C) 2021 Intel Corporation.
.\"
.TH "MEMTIER" 7 "2021-03-01" "Intel Corporation" "MEMTIER" \" -*- nroff -*-
.SH "NAME"
libmemtier.so \- TODO
.SH "SYNOPSIS"
.BR LD_PRELOAD=libmemtier.so
command {arguments ...}
.SH "DESCRIPTION"
.B TODO

.SH "ENVIRONMENT"
.TP
.B MEMKIND_MEM_TIERS
Sets the memkind tiering functionality. Passed as a semicolon separated list
of tier configurations ended with a policy parameter. Each configuration consists of
comma separated list of parameters in following format:
.IP
"name:value,(...)"
, where the name of the parameter could be "KIND" or "RATIO" for all
tiers, "PATH" or "MAX_SIZE" for FS_DAX tiers or "POLICY" for defining allocation
policy that has to be used. The description of specyfic parameters and allowed values is following:
.BR
KIND - the name of a kind used in tiering. Allowed kind names are 'DRAM' and 'FS_DAX'.
.IP
.BR
PATH - the path to the location where pmem file will be created. The path has to exist. Pass this option
only with FS_DAX kind.
.IP
.BR
MAX_SIZE - the size of pmem file, it's the maximum size of total allocations to PMEM. Pass this option
only with FS_DAX kind. The accepted formats are: 1, 1K, 1M, 1G. See
.I memkind(3)
manual for information about limitations to this value which are the same as for the
.I max_size
value in
.I memkind_create_pmem()
function.
.IP
.BR
RATIO - the part of ratio tied to the given kind. It's represented as an
.I unsigned
type. Value should be in range from 1 to
.I UINT_MAX
.IP
.BR
POLICY - determines the algorithm used to distribute allocations between
provided memory kinds. This parameter has to be the last parameter in configuration
string. Currently only
.I POLICY_STATIC_THRESHOLD
and
.I POLICY_DYNAMIC_THRESHOLD
policies are valid. In
.I POLICY_STATIC_THRESHOLD
all allocations are made in such a way that the ratio between memory kinds is static. In
.I POLICY_DYNAMIC_THRESHOLD
the ratio between adjacent memory tiers is kept with a help of set of thresholds between kinds. TODO
.IP
See
.I EXAMPLES
section for an example of usage of
.I MEMKIND_MEM_TIERS
environment variable.
.IP
NOTE: The application will fail when provided environment variable string is not in a correct format.

.SH "CTL API"
.B TODO
.br
Supported names (with type):
policy.dynamic_threshold.thresholds[ID].val (size_t)
policy.dynamic_threshold.thresholds[ID].min (size_t)
policy.dynamic_threshold.thresholds[ID].max (size_t)
policy.dynamic_threshold.check_cnt (unsigned)
policy.dynamic_threshold.trigger (float)
policy.dynamic_threshold.degree (float)
policy.dynamic_threshold.step (size_t)

.SH "EXAMPLES"
.br
The following will run /bin/ls with Memtier library. Make sure that paths to
both libmemtier.so and libmemkind.so are included in
.B LD_LIBRARY_PATH.
.IP
.B LD_PRELOAD=libmemtier.so
/bin/ls -l
.PP
Example usage of MEMKIND_MEM_TIERS environment variable where 20% of allocations will go to PMEM
and 80% of allocations will go to DRAM:
.IP
.B MEMKIND_MEM_TIERS="KIND:FS_DAX,PATH:/tmp/,MAX_SIZE:10G,RATIO:1;KIND:DRAM,RATIO:4;POLICY:POLICY_STATIC_THRESHOLD"

.SH "COPYRIGHT"
Copyright (C) 2021 Intel Corporation. All rights reserved.

.SH "SEE ALSO"
.BR memkind(3),
.BR malloc (3)
